# Tracking new vulnerabilities

You can use Atomist to help your developers detect when a pull reqeust will introduce new vulnerabilities that are not currently running in your production environment.  To see this in action, you'll need to add the Atomist application to one of your GitHub Organizations, and configure the Atomist Dockerhub integration (we'll use DockerHub for this tutorial, but it works equally well with other registries).

## Signup

Start by creating a [free account][signup].

<a href="https://dso.atomist.com/signup"><img src="img/ratchet/signup.png"/></a>

[signup]: https://dso.atomist.com/user/signup

## Connect Github App

Atomist is ready to start discoverying Dockerfiles in your GitHub repositories.  Add the app to one of your GitHub organizations and include some repositories that contain Dockerfiles. Don't worry, because Atomist will only scan default branch refs looking for Dockerfiles that can help with.  It will start raising pull requests, or adding check runs without your permission.  The app will start off in a pure discovery mode.

![app](img/ratchet/GitHubApp.png)

After adding this application, Atomist will start scanning so you'll see data about Dockerfiles, base images, and Dockerfile best practices.  Before diving into this, we'll set up the DockerHub integration to watch your registry.

## Connect DockerHub

For this exercise, we recommend creating a new public Repository in your Docker namespace.  

To [configure the DockerHub integration][dockerhub], navigate to the "Integrations" tab.  You'll need to either create a new personal access token or use an existing one.  Note that DockerHub has recently started limiting the number of personal access tokens that you can create from a free account.  After saving the configuration, Atomist will test the connection and indicate with a green check mark if the connection was made successfully.

![success](img/ratchet/dockerhub_success.png)

In the [configuration docs][dockerhub], there's some additional info on creating a webhook on your new DockerHub repository.  Configure and Atomist webhook on your new repository.  Atomist will use this to track when new Images are pushed into the repository.

[dockerhub]: https://docs.atomist.com/integration/dockerhub/

![repo](img/ratchet/CreateDHRepo.png)
![webhook](img/ratchet/CreateDHWebhook.png)

## Recognizing new vulnerabilities

Atomist is now scanning GitHub commits and Docker Images.  Getting started with vulnerability analysis can be a challenge for teams. Before your appsec team has finished triaging the existing vulnerabilities, it can be difficult for developers to know whether they are being told about a new vulnerability, or whether this is something that is already in production.  Creating a pull request based feedback loop between developers and appsec when _new_ vulnerabilities are introduced focuses the team's attention on a new vulnerability as it's being introduced.  Compare this to a process where quarterly audits resurrect these issues a few months down the road.  The added context that this pull request is potentially increasing the vulnerability debt is a good reason to pull in appsec right now.  Atomist delivers this additional information in the form of a GitHub CheckRun.

![CheckRun]()

Just so you can see this action, we've prepared a repository with a set of known (and triaged) vulnerabilities.  For this exercise, we'll mark this initial set of vulnerabilities as being "deployed" and only complain about ones that are not in this initial set.  The steps of the tutorial are roughly:

1.  Fork a test repository
2.  GitHub Action
3.  Atomist will publish a CheckRun showing you that your new Image has been scanned.
4.  Mark the initial set of vulnerabilities as "deployed"
5.  Open a Pull Request
6.  Introduce a new vulnerability (we'll do this by adding an npm dependency with a known CVE)
7.  Push your change to the Pull Request branch (let the GitHub Action build and push the Image)
8.  Get a failed GitHub CheckRun with details about the new vulnerability

## Fork Test Repo


